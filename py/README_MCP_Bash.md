# MCP Bash æœåŠ¡å™¨ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºŽ Model Context Protocol (MCP) çš„ Bash å‘½ä»¤æ‰§è¡ŒæœåŠ¡å™¨ï¼Œå…è®¸é€šè¿‡ HTTP æŽ¥å£è¿œç¨‹æ‰§è¡Œ bash å‘½ä»¤ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ðŸ”§ **è¿œç¨‹ Bash å‘½ä»¤æ‰§è¡Œ**: é€šè¿‡ HTTP æŽ¥å£æ‰§è¡Œ bash å‘½ä»¤
- ðŸ“ **å·¥ä½œç›®å½•ç®¡ç†**: æ”¯æŒè®¾ç½®å’Œåˆ‡æ¢å·¥ä½œç›®å½•
- ðŸ“ **è¯¦ç»†æ—¥å¿—è®°å½•**: å®Œæ•´çš„è¿è¡Œæ—¶æ—¥å¿—ï¼ŒåŒ…æ‹¬å‘½ä»¤æ‰§è¡Œå’Œé”™è¯¯ä¿¡æ¯
- ðŸŒ **HTTP ä¼ è¾“**: ä½¿ç”¨ streamable-http ä¼ è¾“åè®®
- ðŸ”’ **å®‰å…¨æ‰§è¡Œ**: åœ¨æŒ‡å®šå·¥ä½œç›®å½•ä¸­æ‰§è¡Œå‘½ä»¤

## æœåŠ¡å™¨é…ç½®

### ç«¯å£å’Œä¸»æœºè®¾ç½®

æœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ `0.0.0.0:8080`ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ `mcp_bash_server.py` ä¸­çš„é…ç½®æ¥æ›´æ”¹ï¼š

```python
mcp = FastMCP("Bash", host="0.0.0.0", port=8080)
```

### å¯ç”¨çš„ä¼ è¾“æ–¹å¼

FastMCP æ”¯æŒä»¥ä¸‹ä¼ è¾“æ–¹å¼ï¼š
- `stdio` (é»˜è®¤) - æ ‡å‡†è¾“å…¥è¾“å‡º
- `sse` - Server-Sent Events
- `streamable-http` - HTTP æµå¼ä¼ è¾“

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
uv run mcp_bash_server.py
```

æœåŠ¡å™¨å¯åŠ¨åŽä¼šæ˜¾ç¤ºï¼š
```
2025-08-04 11:12:22,787 - __main__ - INFO - MCP Bash server initialized
2025-08-04 11:12:22,787 - __main__ - INFO - Server will run on 0.0.0.0:8080
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```

### 2. ä½¿ç”¨å®¢æˆ·ç«¯

#### æµ‹è¯•æ¨¡å¼
```bash
uv run mcp_bash_client.py test
```

#### äº¤äº’æ¨¡å¼
```bash
uv run mcp_bash_client.py
```

åœ¨äº¤äº’æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥è¾“å…¥ bash å‘½ä»¤ï¼š
```
bash> pwd
è¾“å‡º: /private/tmp

bash> ls -la
è¾“å‡º: total 0
drwxrwxrwt  5 root  wheel  160 Aug  4 09:42 .
drwxr-xr-x  6 root  wheel  192 Jul 28 21:22 ..
...
```

## API æŽ¥å£

### å¯ç”¨å·¥å…·

1. **set_cwd(path: str) -> str**
   - è®¾ç½®å·¥ä½œç›®å½•
   - å‚æ•°: `path` - ç»å¯¹è·¯å¾„
   - è¿”å›ž: ç¡®è®¤æ¶ˆæ¯

2. **execute_bash(cmd: str) -> Tuple[str, str]**
   - æ‰§è¡Œ bash å‘½ä»¤
   - å‚æ•°: `cmd` - è¦æ‰§è¡Œçš„ shell å‘½ä»¤
   - è¿”å›ž: (stdout, stderr) å…ƒç»„

### HTTP ç«¯ç‚¹

- **ç«¯ç‚¹**: `http://localhost:8080/mcp`
- **åè®®**: streamable-http
- **æ–¹æ³•**: POST/GET/DELETE

## å®¢æˆ·ç«¯é…ç½®

å®¢æˆ·ç«¯ä½¿ç”¨ä»¥ä¸‹é…ç½®è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼š

```python
mcp_client = Client(
    {
        "mcpServers": {
            "bash": {
                "transport": "streamable-http",
                "url": "http://localhost:8080/mcp",
            }
        }
    }
)
```

## æ—¥å¿—è®°å½•

æœåŠ¡å™¨æä¾›è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼š

- **æŽ§åˆ¶å°è¾“å‡º**: å®žæ—¶æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€å’Œå‘½ä»¤æ‰§è¡Œæƒ…å†µ
- **æ–‡ä»¶æ—¥å¿—**: ä¿å­˜åˆ° `mcp_bash_server.log` æ–‡ä»¶
- **æ—¥å¿—çº§åˆ«**: INFO çº§åˆ«ï¼ŒåŒ…å«æ—¶é—´æˆ³å’Œè¯¦ç»†ä¿¡æ¯

### æ—¥å¿—ç¤ºä¾‹

```
2025-08-04 11:12:22,787 - __main__ - INFO - MCP Bash server initialized
2025-08-04 11:12:22,787 - __main__ - INFO - Server will run on 0.0.0.0:8080
2025-08-04 11:12:22,787 - __main__ - INFO - Initial working directory: /Users/zliu/git/mcp_misc/py
2025-08-04 11:12:22,788 - __main__ - INFO - Starting MCP Bash server...
2025-08-04 11:12:22,788 - __main__ - INFO - Starting server with streamable-http transport...
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å·¥ä½œç›®å½•é™åˆ¶**: å‘½ä»¤åœ¨æŒ‡å®šçš„å·¥ä½œç›®å½•ä¸­æ‰§è¡Œ
2. **é”™è¯¯å¤„ç†**: æ— æ•ˆç›®å½•ä¼šæŠ›å‡ºå¼‚å¸¸
3. **æ—¥å¿—è®°å½•**: æ‰€æœ‰å‘½ä»¤æ‰§è¡Œéƒ½æœ‰è¯¦ç»†æ—¥å¿—
4. **ç½‘ç»œè®¿é—®**: æœåŠ¡å™¨ç»‘å®šåˆ° `0.0.0.0`ï¼Œç¡®ä¿ç½‘ç»œå¯è®¿é—®

## æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿žæŽ¥å¤±è´¥**: ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œåœ¨æ­£ç¡®çš„ç«¯å£
2. **404 é”™è¯¯**: ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç«¯ç‚¹ `/mcp`
3. **æƒé™é”™è¯¯**: æ£€æŸ¥å·¥ä½œç›®å½•çš„è¯»å†™æƒé™
4. **å‘½ä»¤æ‰§è¡Œå¤±è´¥**: æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
curl -v http://localhost:8080/mcp

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f mcp_bash_server.log

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080
```

## æ‰©å±•åŠŸèƒ½

å¯ä»¥è½»æ¾æ‰©å±•æœåŠ¡å™¨åŠŸèƒ½ï¼š

1. **æ·»åŠ æ–°å·¥å…·**: ä½¿ç”¨ `@mcp.tool()` è£…é¥°å™¨
2. **æ·»åŠ èµ„æº**: ä½¿ç”¨ `@mcp.resource()` è£…é¥°å™¨
3. **è‡ªå®šä¹‰é…ç½®**: ä¿®æ”¹ FastMCP åˆå§‹åŒ–å‚æ•°
4. **è®¤è¯æœºåˆ¶**: æ·»åŠ  OAuth æˆ–å…¶ä»–è®¤è¯æ–¹å¼

## ä¾èµ–é¡¹

- `fastmcp>=2.11.0`
- `mcp[cli]>=1.12.3`
- Python 3.12+
